<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>G√∂teborgs Befolkningsprognos</title>
  <meta name="description" content="Interaktiv presentation med zoom transitions och Ken Burns effekter">
  <meta name="author" content="Henrik S√∂derholm">
  <meta property="og:type" content="website">
  <meta property="og:title" content="G√∂teborgs Befolkningsprognos">
  <meta property="og:description" content="Interaktiv presentation med zoom transitions och Ken Burns effekter">

  <meta property="og:url" content="https://storyrooms.github.io/gbg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="G√∂teborgs Befolkningsprognos">
  <meta name="twitter:description" content="Interaktiv presentation med zoom transitions och Ken Burns effekter">

  <meta name="generator" content="StoryRooms v1.9">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
    /* BASE STYLES - from v1.7 (unchanged) */
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { width: 100%; height: 100%; overflow: hidden; position: fixed; }
    body { background: #000; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; color: white; display: flex; flex-direction: column; }

    /* WELCOME SCREEN - from v1.7 */
    #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 3000; transition: opacity 1s ease; overflow: hidden; background: #000; }
    #welcome-screen.hidden { opacity: 0; pointer-events: none; z-index: -1; }
    #hero-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transform: scale(1.1); }
    #welcome-screen.hero-full #hero-background { animation: kenBurnsWelcome 20s ease-in-out infinite alternate; }
    @keyframes kenBurnsWelcome { 0% { transform: scale(1.1) translateX(0); } 100% { transform: scale(1.15) translateX(-2%); } }
    #hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backdrop-filter: blur(3px); }
    #welcome-screen.hero-full #hero-overlay { background: linear-gradient(135deg, rgba(0, 118, 188, 0.85) 0%, rgba(0, 90, 148, 0.90) 50%, rgba(0, 60, 110, 0.95) 100%); }
    #welcome-screen.hero-cinematic #hero-overlay { background: linear-gradient(to bottom, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.6) 100%); backdrop-filter: blur(1px); }
    @media (max-width: 768px) { #welcome-screen.hero-cinematic #hero-overlay { background: linear-gradient(to bottom, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.8) 100%); } }
    #welcome-screen.hero-cinematic #hero-background { animation: none; transform: scale(1.05); transition: transform 0.5s ease; }
    #welcome-screen.hero-cinematic:hover #hero-background { transform: scale(1.08); }
    #hero-content { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    #welcome-screen.hero-cinematic.layout-asymmetric #hero-content { align-items: flex-start; justify-content: center; padding-left: 60px; max-width: 65%; }
    @media (max-width: 768px) { #welcome-screen.hero-cinematic.layout-asymmetric #hero-content { align-items: center; padding-left: 20px; max-width: 100%; } }

    /* TYPOGRAPHY - from v1.7 */
    #welcome-title { font-weight: 800; margin-bottom: 20px; text-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); line-height: 1.1; opacity: 0; transform: translateY(30px); animation: fadeInUp 1s ease 0.3s forwards; }
    #welcome-screen.hero-full #welcome-title { font-size: clamp(32px, 10vw, 72px); text-align: center; }
    #welcome-screen.hero-cinematic #welcome-title { font-size: clamp(48px, 12vw, 96px); text-align: left; letter-spacing: -0.02em; line-height: 0.95; }
    @media (max-width: 768px) { #welcome-screen.hero-cinematic #welcome-title { text-align: center; } }
    #welcome-subtitle { font-weight: 300; text-shadow: 0 4px 16px rgba(0, 0, 0, 0.5); opacity: 0; margin-bottom: 40px; transform: translateY(30px); animation: fadeInUp 1s ease 0.6s forwards; }
    #welcome-screen.hero-full #welcome-subtitle { font-size: clamp(18px, 5vw, 32px); text-align: center; }
    #welcome-screen.hero-cinematic #welcome-subtitle { font-size: clamp(20px, 4vw, 28px); text-align: left; max-width: 600px; }
    @media (max-width: 768px) { #welcome-screen.hero-cinematic #welcome-subtitle { text-align: center; } }
    #welcome-tagline { font-size: clamp(14px, 3vw, 18px); opacity: 0; margin-bottom: 40px; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; transform: translateY(30px); animation: fadeInUp 1s ease 0.8s forwards; }
    #welcome-screen.hero-full #welcome-tagline { text-align: center; }
    #welcome-screen.hero-cinematic #welcome-tagline { text-align: left; }
    @media (max-width: 768px) { #welcome-screen.hero-cinematic #welcome-tagline { text-align: center; } }
    #welcome-tagline::before { content: ""; display: inline-block; width: 40px; height: 3px; background: var(--accent-color, #FF6B35); margin-right: 15px; vertical-align: middle; }
    #welcome-meta { font-size: clamp(14px, 3.5vw, 20px); opacity: 0; margin-bottom: 40px; text-align: center; font-weight: 400; transform: translateY(30px); animation: fadeInUp 1s ease 0.9s forwards; }
    #start-button { font-size: clamp(18px, 4vw, 24px); padding: 20px 50px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 700; min-height: 60px; touch-action: manipulation; opacity: 0; transform: translateY(30px) scale(0.9); animation: fadeInUpScale 1s ease 1.2s forwards; }
    #welcome-screen.hero-full #start-button { background: white; color: #0076bc; }
    #welcome-screen.hero-cinematic #start-button { background: var(--accent-color, #FF6B35); color: white; }
    #start-button:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); }
    #start-button:active { transform: translateY(-2px) scale(1.02); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUpScale { to { opacity: 1; transform: translateY(0) scale(1); } }

    /* MAIN CONTENT */
    #main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; padding-top: 35px; padding-bottom: 90px; }
    #media-container { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; min-height: 0; padding: 10px; perspective: 1000px; }
    .slide-image, .slide-video { max-width: 100%; max-height: 100%; width: auto; height: auto; cursor: pointer; position: absolute; opacity: 0; transform: scale(0.8); transition: opacity 0.8s ease, transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8); object-fit: contain; touch-action: manipulation; }
    .slide-image.active, .slide-video.active { opacity: 1; transform: scale(1); z-index: 10; }
    .slide-image.ken-burns { animation: kenBurns 15s ease-in-out infinite alternate; }
    @keyframes kenBurns { 0% { transform: scale(1) translate(0, 0); } 100% { transform: scale(1.08) translate(-2%, -1%); } }
    .slide-image.active.ken-burns { transform: scale(1); animation: kenBurns 15s ease-in-out infinite alternate; }
    .transition-zoom .slide-image:not(.active), .transition-zoom .slide-video:not(.active) { transform: scale(1.2); }
    #text-area { flex-shrink: 0; background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95), #000); padding: 20px 20px; min-height: 120px; max-height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border-top: 2px solid rgba(0, 118, 188, 0.3); gap: 8px; }
    #slide-title { font-size: clamp(20px, 4.5vw, 32px); font-weight: 700; margin-bottom: 8px; color: #fff; text-align: center; line-height: 1.3; width: 100%; opacity: 0; transform: translateY(10px); transition: opacity 0.6s ease 0.2s, transform 0.6s ease 0.2s; }
    #slide-title.show { opacity: 1; transform: translateY(0); }
    #slide-subtitle { font-size: clamp(15px, 3.5vw, 20px); opacity: 0; color: #ddd; text-align: center; line-height: 1.4; width: 100%; transform: translateY(10px); transition: opacity 0.6s ease 0.4s, transform 0.6s ease 0.4s; }
    #slide-subtitle.show { opacity: 0.9; transform: translateY(0); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    /* v1.8 NEW: CHAPTER SYSTEM */
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Chapter transition overlay */
    #chapter-transition { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 1500; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
    #chapter-transition.show { opacity: 1; }
    body:has(#welcome-screen:not(.hidden)) #chapter-transition { opacity: 0 !important; }
    #chapter-transition-content { text-align: center; transform: translateY(20px); opacity: 0; transition: all 0.5s ease; }
    #chapter-transition.show #chapter-transition-content { transform: translateY(0); opacity: 1; }
    #chapter-transition-line { width: 200px; height: 2px; background: linear-gradient(90deg, transparent, var(--accent-color, #0076bc), transparent); margin: 20px auto; }
    #chapter-transition-name { font-size: clamp(24px, 6vw, 48px); font-weight: 700; color: white; text-transform: uppercase; letter-spacing: 0.05em; }

    /* Chapter button */
    #chapter-button { position: absolute; top: 15px; left: 15px; width: 36px; height: 36px; border-radius: 50%; background: rgba(0, 118, 188, 0.8); border: 2px solid rgba(255, 255, 255, 0.3); color: white; font-size: 18px; display: none; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; touch-action: manipulation; z-index: 200; }
    #chapter-button.show { display: flex; }
    #chapter-button:active { transform: scale(0.9); background: rgba(0, 118, 188, 1); }

    /* Chapter menu */
    #chapter-menu { position: fixed; z-index: 2500; border-radius: 20px 20px 0 0; box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5); border-top: 2px solid rgba(0, 118, 188, 0.5); opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0, 0, 0, 0.98), rgba(0, 0, 0, 0.95)); backdrop-filter: blur(20px); padding: 30px 20px 90px 20px; transform: translateY(100%); max-height: 70vh; overflow-y: auto; }
    #chapter-menu.open { opacity: 1; pointer-events: all; transform: translateY(0); }
    #chapter-menu-title { font-size: clamp(24px, 6vw, 32px); font-weight: 700; text-align: center; margin-bottom: 25px; color: white; }
    .chapter-item { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px 20px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 15px; border: 2px solid transparent; }
    .chapter-item:hover { background: rgba(255, 255, 255, 0.1); }
    .chapter-item:active { transform: scale(0.98); }
    .chapter-item.current { border-color: var(--accent-color, #0076bc); background: rgba(0, 118, 188, 0.15); }
    .chapter-icon { font-size: 20px; min-width: 24px; text-align: center; }
    .chapter-name { flex: 1; font-size: clamp(16px, 4vw, 18px); font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .chapter-count { font-size: clamp(13px, 3vw, 14px); color: #aaa; }

    /* UI ELEMENTS */
    body:has(#welcome-screen:not(.hidden)) #info-button,
    body:has(#welcome-screen:not(.hidden)) #share-button,
    body:has(#welcome-screen:not(.hidden)) #chapter-button,
    body:has(#welcome-screen:not(.hidden)) #controls,
    body:has(#welcome-screen:not(.hidden)) #progress-bar,
    body:has(#welcome-screen:not(.hidden)) #keyboard-hints {
      opacity: 0 !important;
      pointer-events: none !important;
    }

    #info-button, #share-button { position: absolute; top: 15px; width: 36px; height: 36px; border-radius: 50%; background: rgba(0, 118, 188, 0.8); border: 2px solid rgba(255, 255, 255, 0.3); color: white; font-size: 18px; font-weight: 600; font-style: normal; display: none; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; touch-action: manipulation; z-index: 200; }
    #info-button { right: 15px; }
    #share-button { left: 15px; font-size: 16px; }
    #info-button.show, #share-button.show { display: flex; }
    #info-button:active, #share-button:active { transform: scale(0.9); background: rgba(0, 118, 188, 1); }

    /* When chapters exist, move share button */
    body.has-chapters #share-button { left: 65px; }

    #progress-bar { position: fixed; top: 0; left: 0; width: 0%; height: 3px; background: linear-gradient(90deg, #0076bc, #00a8e8); transition: width 0.5s ease; z-index: 1000; box-shadow: 0 0 10px rgba(0, 118, 188, 0.6); }
    #controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.85); padding: 10px 18px; border-radius: 50px; display: flex; gap: 12px; align-items: center; backdrop-filter: blur(15px); box-shadow: 0 8px 40px rgba(0, 118, 188, 0.4); border: 1px solid rgba(0, 118, 188, 0.4); z-index: 1000; }
    button { background: linear-gradient(135deg, #0076bc, #005a94); color: white; border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-size: clamp(14px, 3vw, 16px); font-weight: 600; transition: all 0.3s ease; min-height: 44px; touch-action: manipulation; }
    button:active:not(:disabled) { transform: translateY(1px); }
    button:disabled { background: #333; opacity: 0.4; }
    #slide-counter { color: white; font-size: clamp(13px, 3vw, 18px); font-weight: 600; min-width: 70px; text-align: center; background: rgba(0, 118, 188, 0.25); padding: 8px 12px; border-radius: 20px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }

    /* INFO PANEL - from v1.7 */
    #info-panel { position: fixed; z-index: 2500; border-radius: 20px 20px 0 0; box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5); border-top: 2px solid rgba(0, 118, 188, 0.5); opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0, 0, 0, 0.98), rgba(0, 0, 0, 0.95)); backdrop-filter: blur(20px); padding: 25px 20px 90px 20px; transform: translateY(100%); max-height: 70vh; overflow-y: auto; overflow-x: hidden; }
    #info-panel.open { opacity: 1; pointer-events: all; transform: translateY(0); }
    #info-panel::after { content: "‚Üì mer"; position: sticky; bottom: 10px; left: 50%; transform: translateX(-50%); display: inline-block; padding: 6px 20px; background: rgba(0, 118, 188, 0.3); border-radius: 20px; font-size: 12px; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    #info-panel.has-scroll::after { opacity: 1; }
    #info-panel::-webkit-scrollbar { width: 8px; }
    #info-panel::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
    #info-panel::-webkit-scrollbar-thumb { background: rgba(0, 118, 188, 0.5); border-radius: 10px; }
    #info-panel::-webkit-scrollbar-thumb:hover { background: rgba(0, 118, 188, 0.7); }
    #info-content { font-size: clamp(15px, 3.5vw, 17px); line-height: 1.7; color: #eee; max-width: 100%; padding-right: 10px; }
    #info-content strong { color: #fff; font-weight: 700; }
    #info-content em { color: #ccc; font-style: italic; }
    #info-content br { margin-bottom: 0.5em; }
    #info-links { margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
    .info-link { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; font-size: clamp(14px, 3vw, 16px); }
    .info-link-icon { font-size: 18px; min-width: 24px; text-align: center; }
    .info-link-label { color: #aaa; font-weight: 500; }
    .info-link-url { color: rgba(0, 168, 232, 1); text-decoration: none; transition: color 0.3s ease; word-break: break-all; }
    .info-link-url:hover { color: rgba(100, 200, 255, 1); text-decoration: underline; }
    .info-link-url:active { color: rgba(0, 118, 188, 1); }

    /* SHARE PANEL */
    #share-panel { position: fixed; z-index: 2500; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 2px solid rgba(255, 255, 255, 0.1); opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: linear-gradient(135deg, rgba(0, 118, 188, 0.95), rgba(0, 90, 148, 0.95)); backdrop-filter: blur(20px); padding: 30px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
    #share-panel.open { opacity: 1; pointer-events: all; transform: translate(-50%, -50%) scale(1); }
    #share-panel h3 { font-size: 28px; font-weight: 600; margin-bottom: 25px; text-align: center; color: white; }
    #share-url { width: 100%; padding: 14px; border-radius: 10px; border: 2px solid rgba(255, 255, 255, 0.2); background: rgba(0, 0, 0, 0.2); color: white; font-size: 14px; margin: 15px 0; font-family: monospace; outline: none; }
    #copy-button { width: 100%; padding: 16px; background: white; color: #0076bc; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; margin-bottom: 25px; touch-action: manipulation; transition: all 0.3s ease; }
    #copy-button:active { transform: scale(0.98); }
    #qr-code { text-align: center; margin: 20px 0 0 0; }
    #qr-code canvas { border-radius: 12px; background: white; padding: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); }

    /* CLOSE BUTTONS */
    #info-close, #share-close, #chapter-close { position: absolute; top: 15px; right: 15px; width: 32px; height: 32px; border-radius: 50%; background: transparent; border: none; color: rgba(255, 255, 255, 0.6); font-size: 20px; font-weight: 300; display: flex; align-items: center; justify-content: center; cursor: pointer; touch-action: manipulation; transition: all 0.3s ease; }
    #info-close:hover, #share-close:hover, #chapter-close:hover { color: white; background: rgba(255, 255, 255, 0.1); }
    #info-close:active, #share-close:active, #chapter-close:active { transform: scale(0.9); }

    /* MISC */
    #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(0, 118, 188, 0.95); color: white; padding: 15px 30px; border-radius: 50px; font-size: 14px; font-weight: 600; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 3000; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3); }
    #toast.show { opacity: 1; }
    #swipe-indicator { position: fixed; bottom: 50%; left: 50%; transform: translate(-50%, 50%); font-size: 18px; color: rgba(255, 255, 255, 0.7); background: rgba(0, 0, 0, 0.6); padding: 12px 20px; border-radius: 25px; opacity: 0; transition: opacity 0.3s ease; z-index: 500; pointer-events: none; }
    #swipe-indicator.show { opacity: 1; }
    #keyboard-hints { position: fixed; bottom: 15px; left: 15px; background: rgba(0, 0, 0, 0.7); padding: 8px 14px; border-radius: 8px; font-size: 12px; color: #ccc; backdrop-filter: blur(10px); z-index: 999; display: none; }
    #keyboard-hints kbd { background: rgba(255, 255, 255, 0.15); padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 11px; }

    @media (max-width: 768px) {
      #welcome-title { font-size: clamp(28px, 8vw, 48px); }
      #text-area { padding: 18px 15px; min-height: 100px; max-height: 160px; }
      #info-button, #share-button, #chapter-button { width: 32px; height: 32px; font-size: 18px; top: 12px; }
      body.has-chapters #share-button { left: 55px; }
      #chapter-button { left: 12px; }
      #info-close, #share-close, #chapter-close { width: 28px; height: 28px; font-size: 18px; top: 12px; right: 12px; }
      #share-panel { padding: 25px 20px; max-width: 95vw; }
      #share-panel h3 { font-size: 24px; margin-bottom: 20px; }
    }

    @media (min-width: 769px) {
      #keyboard-hints { display: block; }
      button:hover:not(:disabled) { background: linear-gradient(135deg, #005a94, #004070); transform: translateY(-2px); }
      #info-button:hover, #share-button:hover, #chapter-button:hover { background: rgba(0, 118, 188, 1); transform: scale(1.05); }
    }
  </style>
</head>
<body>

  <div id="welcome-screen" class="hero-full">
    <img id="hero-background" src="" alt="">
    <div id="hero-overlay"></div>
    <div id="hero-content">
      <div id="welcome-title"></div>
      <div id="welcome-subtitle"></div>
      <div id="welcome-tagline"></div>
      <div id="welcome-meta"></div>
      <button id="start-button">Starta presentation</button>
    </div>
  </div>

  <div id="chapter-transition">
    <div id="chapter-transition-content">
      <div id="chapter-transition-line"></div>
      <div id="chapter-transition-name"></div>
      <div id="chapter-transition-line"></div>
    </div>
  </div>

  <div id="progress-bar"></div>
  <button id="chapter-button">üìö</button>
  <button id="share-button">üîó</button>
  <div id="swipe-indicator">üëà</div>
  <div id="toast">L√§nk kopierad!</div>

  <div id="main-content">
    <div id="media-container" class="transition-zoom"></div>
    <div id="text-area">
      <div id="slide-title"></div>
      <div id="slide-subtitle"></div>
      <button id="info-button">i</button>
    </div>
  </div>

  <div id="info-panel">
    <button id="info-close">‚úï</button>
    <div id="info-content"></div>
    <div id="info-links"></div>
  </div>

  <div id="chapter-menu">
    <button id="chapter-close">‚úï</button>
    <div id="chapter-menu-title">KAPITEL</div>
    <div id="chapter-menu-items"></div>
  </div>

  <div id="share-panel">
    <button id="share-close">‚úï</button>
    <h3>Dela</h3>
    <input type="text" id="share-url" readonly>
    <button id="copy-button">Kopiera l√§nk</button>
    <div id="qr-code"></div>
  </div>

  <div id="controls">
    <button id="prev-btn">‚Üê</button>
    <div id="slide-counter"></div>
    <button id="next-btn">‚Üí</button>
    <button id="reset-btn">‚ü≤</button>
  </div>

  <div id="keyboard-hints">
    <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>i</kbd> <kbd>s</kbd> <kbd>c</kbd>
  </div>

  <script>
    const config = {
      title: "G√∂teborgs Befolkningsprognos",
      subtitle: "En resa fr√•n 2025 till 2050",
      author: "Henrik S√∂derholm",
      description: "Interaktiv presentation med zoom transitions och Ken Burns effekter",
      thumbnail: "",
      heroImage: "GlobalFunLearning_winter.png",
      url: "https://storyrooms.github.io/gbg",
      duration: 3,
      enableSharing: true,
      enableKenBurns: true,
      transitionStyle: "zoom",

      heroStyle: "cinematic",
      heroLayout: "asymmetric",
      heroAccentColor: "#0076bc",
      heroTagline: "Data ‚Ä¢ Storytelling ‚Ä¢ 2025‚Äì2050",
      ctaText: "B√∂rja resan",
      showHeroMeta: false,

      hasChapters: true,
      chapters: [
    {
  id: 0,
  name: "Bakgrund",
  startSlide: 0,
  endSlide: 0,
  slideCount: 1
},
    {
  id: 1,
  name: "1. Historia",
  startSlide: 1,
  endSlide: 2,
  slideCount: 2
},
    {
  id: 2,
  name: "2. Nul√§get",
  startSlide: 3,
  endSlide: 3,
  slideCount: 1
},
    {
  id: 3,
  name: "3. Framtiden",
  startSlide: 4,
  endSlide: 4,
  slideCount: 1
}
  ],

      slides: [
{
      file: "03_karta_region.png",
      title: "G√∂teborg och regionen",
      subtitle: "Arbets- och bostadsmarknadens geografi",
      info: "Pendlingsstr√∂mmar och flyttr√∂relser visar att ‚ÄúG√∂teborg √§r k√§rnan i en bostads- och arbetsmarknadsregion som str√§cker sig utanf√∂r kommunens gr√§nser. <br><br>Vi ser samtidigt tydliga <strong>tecken p√• livsfasrelaterade flyttm√∂nster i regionen</strong> med unga vuxna som flyttar till G√∂teborg och en stor omflyttning av barnfamiljer inom regionen fram till skolan b√∂rjar. <br><br>Exempel p√• fr√•gor som √§r viktiga att f√∂lja √§r <strong>bostadsbest√•ndets f√∂rdelning</strong> inom G√∂teborg och √∂vriga regionen, <strong>bostadsbyggandet, generationsskiften i bostadsomr√•den och infrastruktursatsningar</strong>. ",
      infoLinks: "<div class=\"info-link\">\n  <span class=\"info-link-icon\">üìÑ</span>\n  <span class=\"info-link-label\">K√§lla:</span>\n  <a href=\"https://scb.se\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"info-link-url\">scb.se</a>\n</div>",
      chapter: "Bakgrund"
    },
{
      file: "RUM_1.png",
      title: "1990",
      subtitle: "433,000",
      chapter: "1. Historia"
    },
{
      file: "RUM_2.png",
      title: "2000",
      subtitle: "458,000",
      chapter: "1. Historia"
    },
{
      file: "RUM_1.png",
      title: "2024",
      subtitle: "580,000",
      chapter: "2. Nul√§get"
    },
{
      file: "RUM_2.png",
      title: "Framtid",
      subtitle: "640,000",
      chapter: "3. Framtiden"
    }
      ]
    };

    document.documentElement.style.setProperty("--accent-color", config.heroAccentColor);

    const welcomeScreen = document.getElementById("welcome-screen");
    welcomeScreen.classList.remove("hero-full", "hero-cinematic");
    welcomeScreen.classList.add(`hero-${config.heroStyle}`);

    if (config.heroLayout === "asymmetric") {
      welcomeScreen.classList.add("layout-asymmetric");
    }

    // v1.8: Add class if chapters exist
    if (config.hasChapters) {
      document.body.classList.add("has-chapters");
    }

    let currentSlide = 0;
    let totalSlides = config.slides.length;
    let currentChapter = null;
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartY = 0;
    let touchEndY = 0;
    const swipeThreshold = 50;
    const chapterTransitionDuration = 1500; // ms

    const heroBackground = document.getElementById("hero-background");
    const welcomeTitle = document.getElementById("welcome-title");
    const welcomeSubtitle = document.getElementById("welcome-subtitle");
    const welcomeTagline = document.getElementById("welcome-tagline");
    const welcomeMeta = document.getElementById("welcome-meta");
    const startButton = document.getElementById("start-button");
    const mediaContainer = document.getElementById("media-container");
    const slideTitle = document.getElementById("slide-title");
    const slideSubtitle = document.getElementById("slide-subtitle");
    const infoButton = document.getElementById("info-button");
    const shareButton = document.getElementById("share-button");
    const chapterButton = document.getElementById("chapter-button");
    const infoPanel = document.getElementById("info-panel");
    const infoContent = document.getElementById("info-content");
    const infoLinks = document.getElementById("info-links");
    const infoClose = document.getElementById("info-close");
    const chapterMenu = document.getElementById("chapter-menu");
    const chapterMenuItems = document.getElementById("chapter-menu-items");
    const chapterClose = document.getElementById("chapter-close");
    const chapterTransition = document.getElementById("chapter-transition");
    const chapterTransitionName = document.getElementById("chapter-transition-name");
    const sharePanel = document.getElementById("share-panel");
    const shareUrl = document.getElementById("share-url");
    const copyButton = document.getElementById("copy-button");
    const qrCodeDiv = document.getElementById("qr-code");
    const shareClose = document.getElementById("share-close");
    const progressBar = document.getElementById("progress-bar");
    const slideCounter = document.getElementById("slide-counter");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const resetBtn = document.getElementById("reset-btn");
    const swipeIndicator = document.getElementById("swipe-indicator");
    const toast = document.getElementById("toast");

    // v1.8: Chapter functions
    function getCurrentChapter() {
      if (!config.hasChapters) return null;

      for (let chapter of config.chapters) {
        if (currentSlide >= chapter.startSlide && currentSlide <= chapter.endSlide) {
          return chapter;
        }
      }
      return null;
    }

    function getChapterProgress() {
      const chapter = getCurrentChapter();
      if (!chapter) return null;

      const slideInChapter = currentSlide - chapter.startSlide + 1;
      return `${chapter.name} - Slide ${slideInChapter}/${chapter.slideCount}`;
    }

    function showChapterTransition(chapterName) {
      chapterTransitionName.textContent = chapterName;
      chapterTransition.classList.add("show");

      setTimeout(() => {
        chapterTransition.classList.remove("show");
      }, chapterTransitionDuration);
    }

    function toggleChapterMenu() {
      chapterMenu.classList.toggle("open");
      if (chapterMenu.classList.contains("open")) {
        infoPanel.classList.remove("open");
        sharePanel.classList.remove("open");
        renderChapterMenu();
      }
    }

    function renderChapterMenu() {
      if (!config.hasChapters) return;

      const currentCh = getCurrentChapter();

      let html = "";
      config.chapters.forEach(chapter => {
        // Enkelt: pil f√∂r nuvarande, ring f√∂r √∂vriga
        const icon = chapter.id === currentCh?.id ? "‚Üí" : "‚óã";
        const classes = ["chapter-item"];
        if (chapter.id === currentCh?.id) classes.push("current");

        const slideText = chapter.slideCount === 1 ? "1 slide" : `${chapter.slideCount} slides`;

        html += `
          <div class="${classes.join(" ")}" onclick="jumpToChapter(${chapter.id})">
            <div class="chapter-icon">${icon}</div>
            <div class="chapter-name">${chapter.name}</div>
            <div class="chapter-count">${slideText}</div>
          </div>
        `;
      });

      chapterMenuItems.innerHTML = html;
    }

    function jumpToChapter(chapterId) {
      const chapter = config.chapters.find(ch => ch.id === chapterId);
      if (!chapter) return;

      chapterMenu.classList.remove("open");

      // Show transition if jumping to different chapter
      const currentCh = getCurrentChapter();
      if (!currentCh || currentCh.id !== chapterId) {
        showChapterTransition(chapter.name);
        setTimeout(() => {
          currentSlide = chapter.startSlide;
          updateSlide();
        }, 200);
      } else {
        currentSlide = chapter.startSlide;
        updateSlide();
      }
    }

    function init() {
      welcomeTitle.textContent = config.title;
      welcomeSubtitle.textContent = config.subtitle;

      if (config.heroTagline && config.heroTagline.length > 0) {
        welcomeTagline.textContent = config.heroTagline;
        welcomeTagline.style.display = "block";
      } else {
        welcomeTagline.style.display = "none";
      }

      if (config.showHeroMeta) {
        welcomeMeta.textContent = `${totalSlides} slides ‚Ä¢ ~${config.duration} min`;
        if (config.author) welcomeMeta.textContent += ` ‚Ä¢ ${config.author}`;
        welcomeMeta.style.display = "block";
      } else {
        welcomeMeta.style.display = "none";
      }

      startButton.textContent = config.ctaText;

      if (config.heroImage) {
        heroBackground.src = config.heroImage;
      }

      if (config.enableSharing && config.url) {
        shareButton.classList.add("show");
        shareUrl.value = config.url;
      }

      // v1.8: Show chapter button if chapters exist
      if (config.hasChapters) {
        chapterButton.classList.add("show");
      }

      if (config.transitionStyle === "zoom") {
        mediaContainer.classList.add("transition-zoom");
      }

      config.slides.forEach((slide, index) => {
        const isVideo = slide.file.match(/\.(mp4|webm|mov)$/i);

        if (isVideo) {
          const video = document.createElement("video");
          video.className = "slide-video";
          video.id = `slide-${index}`;
          video.src = slide.file;
          video.setAttribute("playsinline", "");
          video.setAttribute("webkit-playsinline", "");
          video.muted = true;
          video.addEventListener("click", nextSlide);
          mediaContainer.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.className = "slide-image";
          img.id = `slide-${index}`;
          img.src = slide.file;
          img.alt = slide.title || `Slide ${index + 1}`;

          if (config.enableKenBurns) {
            img.classList.add("ken-burns");
          }

          img.addEventListener("click", nextSlide);
          mediaContainer.appendChild(img);
        }
      });

      config.slides.forEach(slide => {
        if (!slide.file.match(/\.(mp4|webm|mov)$/i)) {
          const img = new Image();
          img.src = slide.file;
        }
      });

      setupTouchHandlers();
    }

    function setupTouchHandlers() {
      document.body.addEventListener("touchstart", (e) => {
        if (welcomeScreen.classList.contains("hidden") &&
            !infoPanel.classList.contains("open") &&
            !sharePanel.classList.contains("open") &&
            !chapterMenu.classList.contains("open")) {
          touchStartX = e.changedTouches[0].screenX;
          touchStartY = e.changedTouches[0].screenY;
        }
      }, { passive: true });

      document.body.addEventListener("touchend", (e) => {
        if (welcomeScreen.classList.contains("hidden") &&
            !infoPanel.classList.contains("open") &&
            !sharePanel.classList.contains("open") &&
            !chapterMenu.classList.contains("open")) {
          touchEndX = e.changedTouches[0].screenX;
          touchEndY = e.changedTouches[0].screenY;
          handleSwipe();
        }
      }, { passive: true });
    }

    function handleSwipe() {
      const deltaX = touchEndX - touchStartX;
      const deltaY = Math.abs(touchEndY - touchStartY);

      if (Math.abs(deltaX) > swipeThreshold && Math.abs(deltaX) > deltaY) {
        if (deltaX > 0) {
          showSwipeIndicator("üëâ");
          prevSlide();
        } else {
          showSwipeIndicator("üëà");
          nextSlide();
        }
      }
    }

    function showSwipeIndicator(emoji) {
      swipeIndicator.textContent = emoji;
      swipeIndicator.classList.add("show");
      setTimeout(() => swipeIndicator.classList.remove("show"), 300);
    }

    function updateSlide() {
      document.querySelectorAll(".slide-image, .slide-video").forEach(el => {
        el.classList.remove("active");
        if (el.tagName === "VIDEO") {
          el.pause();
          el.currentTime = 0;
        }
      });

      slideTitle.classList.remove("show");
      slideSubtitle.classList.remove("show");

      // v1.8: Check if we entered new chapter
      const newChapter = getCurrentChapter();
      if (config.hasChapters && newChapter &&
          (!currentChapter || newChapter.id !== currentChapter.id) &&
          currentSlide === newChapter.startSlide) {
        showChapterTransition(newChapter.name);
      }
      currentChapter = newChapter;

      setTimeout(() => {
        const currentElement = document.getElementById(`slide-${currentSlide}`);
        if (currentElement) {
          currentElement.classList.add("active");
          if (currentElement.tagName === "VIDEO") {
            currentElement.play().catch(() => {});
          }
        }

        const slide = config.slides[currentSlide];
        slideTitle.textContent = slide.title || "";
        slideSubtitle.textContent = slide.subtitle || "";

        setTimeout(() => {
          if (slide.title) slideTitle.classList.add("show");
          if (slide.subtitle) slideSubtitle.classList.add("show");
        }, 100);

        if (slide.info && slide.info.length > 0) {
          infoButton.classList.add("show");
        } else {
          infoButton.classList.remove("show");
        }
      }, 100);

      // v1.8: Update counter with chapter info
      if (config.hasChapters && currentChapter) {
        const slideInChapter = currentSlide - currentChapter.startSlide + 1;
        slideCounter.textContent = `${currentChapter.name} - ${slideInChapter}/${currentChapter.slideCount}`;
      } else {
        slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;
      }

      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide === totalSlides - 1;

      progressBar.style.width = ((currentSlide + 1) / totalSlides * 100) + "%";

      infoPanel.classList.remove("open");
      sharePanel.classList.remove("open");
      chapterMenu.classList.remove("open");
    }

    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateSlide();
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateSlide();
      }
    }

    function resetPresentation() {
      currentSlide = 0;
      currentChapter = null;

      // D√∂lj slide-text omedelbart
      slideTitle.classList.remove("show");
      slideSubtitle.classList.remove("show");

      // D√∂lj alla slides
      document.querySelectorAll(".slide-image, .slide-video").forEach(el => {
        el.classList.remove("active");
        if (el.tagName === "VIDEO") {
          el.pause();
          el.currentTime = 0;
        }
      });

      if (config.heroImage) {
        heroBackground.src = config.heroImage;
      }

      // Visa welcome screen - updateSlide() k√∂rs n√§r anv√§ndaren trycker Start
      welcomeScreen.classList.remove("hidden");
    }

    function toggleInfo() {
      const slide = config.slides[currentSlide];
      if (slide.info) {
        infoContent.innerHTML = slide.info;

        if (slide.infoLinks && slide.infoLinks.length > 0) {
          infoLinks.innerHTML = slide.infoLinks;
          infoLinks.style.display = "block";
        } else {
          infoLinks.style.display = "none";
        }

        infoPanel.classList.toggle("open");

        if (infoPanel.classList.contains("open")) {
          sharePanel.classList.remove("open");
          chapterMenu.classList.remove("open");

          setTimeout(() => {
            if (infoPanel.scrollHeight > infoPanel.clientHeight) {
              infoPanel.classList.add("has-scroll");
            } else {
              infoPanel.classList.remove("has-scroll");
            }
          }, 100);
        }
      }
    }

    function toggleShare() {
      sharePanel.classList.toggle("open");
      if (sharePanel.classList.contains("open")) {
        infoPanel.classList.remove("open");
        chapterMenu.classList.remove("open");
        generateQR();
      }
    }

    function copyToClipboard() {
      shareUrl.select();
      shareUrl.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(shareUrl.value).then(() => {
        showToast("L√§nk kopierad!");
      }).catch(err => {
        document.execCommand("copy");
        showToast("L√§nk kopierad!");
      });
    }

    function generateQR() {
      if (!config.url) return;
      qrCodeDiv.innerHTML = "";
      new QRCode(qrCodeDiv, {
        text: config.url,
        width: 200,
        height: 200,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2000);
    }

    startButton.addEventListener("click", () => {
      welcomeScreen.classList.add("hidden");
      setTimeout(updateSlide, 500);
    });

    prevBtn.addEventListener("click", prevSlide);
    nextBtn.addEventListener("click", nextSlide);
    resetBtn.addEventListener("click", resetPresentation);
    infoButton.addEventListener("click", toggleInfo);
    shareButton.addEventListener("click", toggleShare);
    chapterButton.addEventListener("click", toggleChapterMenu);
    infoClose.addEventListener("click", () => infoPanel.classList.remove("open"));
    shareClose.addEventListener("click", () => sharePanel.classList.remove("open"));
    chapterClose.addEventListener("click", () => chapterMenu.classList.remove("open"));
    copyButton.addEventListener("click", copyToClipboard);

    document.addEventListener("keydown", (e) => {
      if (!welcomeScreen.classList.contains("hidden")) {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          startButton.click();
        }
      } else {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextSlide();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevSlide();
        } else if (e.key === "i" || e.key === "I") {
          e.preventDefault();
          toggleInfo();
        } else if (e.key === "s" || e.key === "S") {
          e.preventDefault();
          if (config.enableSharing && config.url) toggleShare();
        } else if (e.key === "c" || e.key === "C") {
          e.preventDefault();
          if (config.hasChapters) toggleChapterMenu();
        } else if (e.key >= "1" && e.key <= "9") {
          e.preventDefault();
          const chapterIndex = parseInt(e.key) - 1;
          if (config.hasChapters && chapterIndex < config.chapters.length) {
            jumpToChapter(chapterIndex);
          }
        } else if (e.key === "Home") {
          e.preventDefault();
          if (config.hasChapters && config.chapters.length > 0) {
            jumpToChapter(0);
          } else {
            currentSlide = 0;
            updateSlide();
          }
        } else if (e.key === "End") {
          e.preventDefault();
          if (config.hasChapters && config.chapters.length > 0) {
            jumpToChapter(config.chapters.length - 1);
          } else {
            currentSlide = totalSlides - 1;
            updateSlide();
          }
        } else if (e.key === "Escape") {
          e.preventDefault();
          infoPanel.classList.remove("open");
          sharePanel.classList.remove("open");
          chapterMenu.classList.remove("open");
        }
      }
    });

    let lastTouchEnd = 0;
    document.addEventListener("touchend", (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    init();
  </script>
  </body>
</html>
