<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>Auto-Advance Demo</title>
  <meta name="description" content="Auto-Advance Demo - En interaktiv presentation med 6 slides">
  <meta name="author" content="">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Auto-Advance Demo">
  <meta property="og:description" content="Auto-Advance Demo - En interaktiv presentation med 6 slides">
  
  

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Auto-Advance Demo">
  <meta name="twitter:description" content="Auto-Advance Demo - En interaktiv presentation med 6 slides">
  

  <meta name="generator" content="StoryRooms">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
    }

    body {
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
    }

    /* =================================================================
       WELCOME SCREEN - HERO STYLE
       ================================================================= */

    #welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2000;
      transition: opacity 1s ease;
      overflow: hidden;
    }

    #welcome-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* Hero background */
    #hero-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.1);
      animation: kenBurnsWelcome 20s ease-in-out infinite alternate;
    }

    @keyframes kenBurnsWelcome {
      0% { transform: scale(1.1) translateX(0); }
      100% { transform: scale(1.15) translateX(-2%); }
    }

    /* Hero overlay */
    #hero-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        135deg,
        rgba(0, 118, 188, 0.85) 0%,
        rgba(0, 90, 148, 0.90) 50%,
        rgba(0, 60, 110, 0.95) 100%
      );
      backdrop-filter: blur(3px);
    }

    /* Hero content */
    #hero-content {
      position: relative;
      z-index: 10;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    #welcome-title {
      font-size: clamp(32px, 10vw, 72px);
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      text-align: center;
      line-height: 1.1;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1s ease 0.3s forwards;
    }

    #welcome-subtitle {
      font-size: clamp(18px, 5vw, 32px);
      opacity: 0;
      margin-bottom: 40px;
      text-align: center;
      font-weight: 300;
      text-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
      transform: translateY(30px);
      animation: fadeInUp 1s ease 0.6s forwards;
    }

    #welcome-meta {
      font-size: clamp(14px, 3.5vw, 20px);
      opacity: 0;
      margin-bottom: 40px;
      text-align: center;
      font-weight: 400;
      transform: translateY(30px);
      animation: fadeInUp 1s ease 0.9s forwards;
    }

    #start-button {
      font-size: clamp(18px, 4vw, 24px);
      padding: 20px 50px;
      background: white;
      color: #0076bc;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 700;
      min-height: 60px;
      touch-action: manipulation;
      opacity: 0;
      transform: translateY(30px) scale(0.9);
      animation: fadeInUpScale 1s ease 1.2s forwards;
    }

    #start-button:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    #start-button:active {
      transform: translateY(-2px) scale(1.02);
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUpScale {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* =================================================================
       MAIN CONTENT - WITH TRANSITIONS
       ================================================================= */

    #main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding-top: 35px;
      padding-bottom: 90px;
    }

    #media-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-height: 0;
      padding: 10px;
      perspective: 1000px;
    }

    /* Slides with transitions */
    .slide-image, .slide-video {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      cursor: pointer;
      position: absolute;
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 0.8s ease, transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
      object-fit: contain;
      touch-action: manipulation;
    }

    .slide-image.active, .slide-video.active {
      opacity: 1;
      transform: scale(1);
      z-index: 10;
    }

    /* Ken Burns effect on images */
    .slide-image.ken-burns {
      animation: kenBurns 15s ease-in-out infinite alternate;
    }

    @keyframes kenBurns {
      0% {
        transform: scale(1) translate(0, 0);
      }
      100% {
        transform: scale(1.08) translate(-2%, -1%);
      }
    }

    .slide-image.active.ken-burns {
      transform: scale(1);
      animation: kenBurns 15s ease-in-out infinite alternate;
    }

    /* Zoom transition */
    .transition-zoom .slide-image:not(.active),
    .transition-zoom .slide-video:not(.active) {
      transform: scale(1.2);
    }

    /* Text Area with animations */
    #text-area {
      flex-shrink: 0;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95), #000);
      padding: 20px 20px;
      min-height: 120px;
      max-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      border-top: 2px solid rgba(0, 118, 188, 0.3);
      gap: 8px;
    }

    #slide-title {
      font-size: clamp(20px, 4.5vw, 32px);
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
      text-align: center;
      line-height: 1.3;
      width: 100%;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.6s ease 0.2s, transform 0.6s ease 0.2s;
    }

    #slide-title.show {
      opacity: 1;
      transform: translateY(0);
    }

    #slide-subtitle {
      font-size: clamp(15px, 3.5vw, 20px);
      opacity: 0;
      color: #ddd;
      text-align: center;
      line-height: 1.4;
      width: 100%;
      transform: translateY(10px);
      transition: opacity 0.6s ease 0.4s, transform 0.6s ease 0.4s;
    }

    #slide-subtitle.show {
      opacity: 0.9;
      transform: translateY(0);
    }

    /* Info & Share buttons */
    #info-button, #share-button {
      position: absolute;
      top: 15px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(0, 118, 188, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 18px;
      font-weight: 600;
      font-style: normal;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      touch-action: manipulation;
      z-index: 200;
    }

    #info-button {
      right: 15px;
    }

    #share-button {
      left: 15px;
      font-size: 16px;
    }

    #info-button.show, #share-button.show {
      display: flex;
    }

    #info-button:active, #share-button:active {
      transform: scale(0.9);
      background: rgba(0, 118, 188, 1);
    }

    /* Progress Bar */
    #progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, #0076bc, #00a8e8);
      transition: width 0.5s ease;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 118, 188, 0.6);
    }

    /* Controls */
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 10px 18px;
      border-radius: 50px;
      display: flex;
      gap: 12px;
      align-items: center;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 40px rgba(0, 118, 188, 0.4);
      border: 1px solid rgba(0, 118, 188, 0.4);
      z-index: 1000;
    }

    button {
      background: linear-gradient(135deg, #0076bc, #005a94);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: clamp(14px, 3vw, 16px);
      font-weight: 600;
      transition: all 0.3s ease;
      min-height: 44px;
      touch-action: manipulation;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    button:disabled {
      background: #333;
      opacity: 0.4;
    }

    #slide-counter {
      color: white;
      font-size: clamp(13px, 3vw, 18px);
      font-weight: 600;
      min-width: 70px;
      text-align: center;
      background: rgba(0, 118, 188, 0.25);
      padding: 8px 12px;
      border-radius: 20px;
    }

    /* Auto-advance countdown timer */
    #countdown-timer {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: rgba(0, 118, 188, 0.85);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #countdown-timer.show {
      opacity: 1;
    }

    #countdown-timer.paused {
      background: rgba(200, 100, 0, 0.85);
    }

    #timer-icon {
      font-size: 16px;
    }

    #timer-value {
      min-width: 20px;
      text-align: center;
    }

    /* Play/Pause button for auto-advance */
    #play-pause-btn {
      background: linear-gradient(135deg, #0076bc, #005a94);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: clamp(14px, 3vw, 16px);
      font-weight: 600;
      transition: all 0.3s ease;
      min-height: 44px;
      touch-action: manipulation;
      display: none;
    }

    #play-pause-btn.show {
      display: block;
    }

    #play-pause-btn.paused {
      background: linear-gradient(135deg, #28a745, #218838);
    }

    /* Panels - Info & Share */
    #info-panel, #share-panel {
      position: fixed;
      z-index: 2500;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.1);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #info-panel {
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.98), rgba(0, 0, 0, 0.95));
      backdrop-filter: blur(20px);
      padding: 25px 20px 90px 20px;
      transform: translateY(100%);
      max-height: 60vh;
      overflow-y: auto;
      border-top: 2px solid rgba(0, 118, 188, 0.5);
    }

    #info-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: translateY(0);
    }

    #info-content {
      font-size: clamp(14px, 3.5vw, 16px);
      line-height: 1.6;
      color: #eee;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
      padding-right: 40px;
      max-width: 100%;
    }

    #share-panel {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: linear-gradient(135deg, rgba(0, 118, 188, 0.95), rgba(0, 90, 148, 0.95));
      backdrop-filter: blur(20px);
      padding: 30px;
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
    }

    #share-panel.open {
      opacity: 1;
      pointer-events: all;
      transform: translate(-50%, -50%) scale(1);
    }

    /* Share Panel Elements */
    #share-panel h3 {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 25px;
      text-align: center;
      color: white;
    }

    #share-url {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.2);
      color: white;
      font-size: 14px;
      margin: 15px 0;
      font-family: monospace;
      outline: none;
    }

    #copy-button {
      width: 100%;
      padding: 16px;
      background: white;
      color: #0076bc;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 25px;
      touch-action: manipulation;
      transition: all 0.3s ease;
    }

    #copy-button:active {
      transform: scale(0.98);
    }

    #qr-code {
      text-align: center;
      margin: 20px 0 0 0;
    }

    #qr-code canvas {
      border-radius: 12px;
      background: white;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    /* Close Buttons - Smaller and More Discrete */
    #info-close, #share-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      font-size: 20px;
      font-weight: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      touch-action: manipulation;
      transition: all 0.3s ease;
    }

    #info-close:hover, #share-close:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
    }

    #info-close:active, #share-close:active {
      transform: scale(0.9);
    }

    /* Branding */
    #branding {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    #branding a {
      color: rgba(0, 118, 188, 0.8);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    #branding a:hover {
      color: rgba(0, 168, 232, 1);
    }

    /* Toast */
    #toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 118, 188, 0.95);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 3000;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    }

    #toast.show {
      opacity: 1;
    }

    /* Swipe Indicator */
    #swipe-indicator {
      position: fixed;
      bottom: 50%;
      left: 50%;
      transform: translate(-50%, 50%);
      font-size: 18px;
      color: rgba(255, 255, 255, 0.7);
      background: rgba(0, 0, 0, 0.6);
      padding: 12px 20px;
      border-radius: 25px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 500;
      pointer-events: none;
    }

    #swipe-indicator.show {
      opacity: 1;
    }

    /* Keyboard Hints */
    #keyboard-hints {
      position: fixed;
      bottom: 15px;
      left: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 12px;
      color: #ccc;
      backdrop-filter: blur(10px);
      z-index: 999;
      display: none;
    }

    #keyboard-hints kbd {
      background: rgba(255, 255, 255, 0.15);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 11px;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      #welcome-title {
        font-size: clamp(28px, 8vw, 48px);
      }

      #text-area {
        padding: 18px 15px;
        min-height: 100px;
        max-height: 160px;
      }

      #info-button, #share-button {
        width: 32px;
        height: 32px;
        font-size: 18px;
        top: 12px;
      }

      #info-close, #share-close {
        width: 28px;
        height: 28px;
        font-size: 18px;
        top: 12px;
        right: 12px;
      }

      #share-panel {
        padding: 25px 20px;
        max-width: 95vw;
      }

      #share-panel h3 {
        font-size: 24px;
        margin-bottom: 20px;
      }

      #branding {
        font-size: 10px;
        bottom: 15px;
        right: 15px;
      }
    }

    /* Desktop */
    @media (min-width: 769px) {
      #keyboard-hints {
        display: block;
      }

      button:hover:not(:disabled) {
        background: linear-gradient(135deg, #005a94, #004070);
        transform: translateY(-2px);
      }

      #info-button:hover, #share-button:hover {
        background: rgba(0, 118, 188, 1);
        transform: scale(1.05);
      }
    }
  </style>
</head>
<body>

  <!-- Welcome Screen with Hero -->
  <div id="welcome-screen">
    <img id="hero-background" src="" alt="">
    <div id="hero-overlay"></div>
    <div id="hero-content">
      <div id="welcome-title"></div>
      <div id="welcome-subtitle"></div>
      <div id="welcome-meta"></div>
      <button id="start-button">Starta presentation</button>
    </div>
  </div>

  <!-- Progress Bar -->
  <div id="progress-bar"></div>

  <!-- Share Button -->
  <button id="share-button">üîó</button>

  <!-- Swipe Indicator -->
  <div id="swipe-indicator">üëà</div>

  <!-- Toast -->
  <div id="toast">L√§nk kopierad!</div>

  <!-- Main Content -->
  <div id="main-content">
    <div id="media-container" class="transition-zoom"></div>
    <div id="text-area">
      <div id="slide-title"></div>
      <div id="slide-subtitle"></div>
      <button id="info-button">i</button>
    </div>
  </div>

  <!-- Info Panel -->
  <div id="info-panel">
    <button id="info-close">‚úï</button>
    <div id="info-content"></div>
  </div>

  <!-- Share Panel -->
  <div id="share-panel">
    <button id="share-close">‚úï</button>
    <h3>Dela</h3>
    <input type="text" id="share-url" readonly>
    <button id="copy-button">Kopiera l√§nk</button>
    <div id="qr-code"></div>
  </div>

  <!-- Countdown Timer -->
  <div id="countdown-timer">
    <span id="timer-icon">‚è±Ô∏è</span>
    <span id="timer-value">5</span>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button id="prev-btn">‚Üê</button>
    <div id="slide-counter"></div>
    <button id="next-btn">‚Üí</button>
    <button id="play-pause-btn">‚è∏</button>
    <button id="reset-btn">‚ü≤</button>
  </div>

  <!-- Keyboard Hints -->
  <div id="keyboard-hints">
    <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>Space</kbd> <kbd>i</kbd> <kbd>s</kbd>
  </div>

  <!-- Branding -->
  <div id="branding">
    Made with <a href="https://github.com/storyrooms" target="_blank">StoryRooms</a>
  </div>

  <script>
        const config = {
      title: "Auto-Advance Demo",
      subtitle: "Sj√§lvk√∂rande presentation",
      author: "",
      description: "Auto-Advance Demo - En interaktiv presentation med 6 slides",
      thumbnail: "",
      heroImage: "RUM_0.png",
      url: "",
      duration: 3,
      enableSharing: true,
      enableKenBurns: true,
      transitionStyle: "zoom",

      slides: [
{
      file: "RUM_0.png",
      title: "V√§lkommen",
      subtitle: "Auto-presentation",
      duration: 5
    },
{
      file: "RUM_1.png",
      title: "Befolkning",
      subtitle: "1990-2024",
      duration: 10
    },
{
      file: "RUM_2.png",
      title: "√Öldersstruktur",
      subtitle: "√Öldrande stad",
      duration: 8
    },
{
      file: "RUM_9.png",
      title: "Migration",
      subtitle: "In- och utflyttning",
      duration: 10
    },
{
      file: "sphere_popup.mp4",
      title: "Framtiden",
      subtitle: "Prognoser",
      duration: 8
    },
{
      file: "RUM_10.png",
      title: "Tack!",
      subtitle: "Fr√•gor?"
    }
      ]
    };

    let currentSlide = 0;
    let totalSlides = config.slides.length;
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartY = 0;
    let touchEndY = 0;
    const swipeThreshold = 50;

    // Auto-advance variables
    let autoAdvanceTimer = null;
    let countdownTimer = null;
    let remainingTime = 0;
    let isPaused = false;
    let hasAutoAdvance = false;

    // Elements
    const welcomeScreen = document.getElementById("welcome-screen");
    const heroBackground = document.getElementById("hero-background");
    const welcomeTitle = document.getElementById("welcome-title");
    const welcomeSubtitle = document.getElementById("welcome-subtitle");
    const welcomeMeta = document.getElementById("welcome-meta");
    const startButton = document.getElementById("start-button");
    const mediaContainer = document.getElementById("media-container");
    const slideTitle = document.getElementById("slide-title");
    const slideSubtitle = document.getElementById("slide-subtitle");
    const infoButton = document.getElementById("info-button");
    const shareButton = document.getElementById("share-button");
    const infoPanel = document.getElementById("info-panel");
    const infoContent = document.getElementById("info-content");
    const infoClose = document.getElementById("info-close");
    const sharePanel = document.getElementById("share-panel");
    const shareUrl = document.getElementById("share-url");
    const copyButton = document.getElementById("copy-button");
    const qrCodeDiv = document.getElementById("qr-code");
    const shareClose = document.getElementById("share-close");
    const progressBar = document.getElementById("progress-bar");
    const slideCounter = document.getElementById("slide-counter");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const playPauseBtn = document.getElementById("play-pause-btn");
    const resetBtn = document.getElementById("reset-btn");
    const countdownTimerEl = document.getElementById("countdown-timer");
    const timerValue = document.getElementById("timer-value");
    const swipeIndicator = document.getElementById("swipe-indicator");
    const toast = document.getElementById("toast");

    // Initialize
    function init() {
      // Welcome screen
      welcomeTitle.textContent = config.title;
      welcomeSubtitle.textContent = config.subtitle;
      welcomeMeta.textContent = `${totalSlides} slides ‚Ä¢ ~${config.duration} min`;
      if (config.author) welcomeMeta.textContent += ` ‚Ä¢ ${config.author}`;

      // Hero image
      if (config.heroImage) {
        heroBackground.src = config.heroImage;
      }

      // Sharing
      if (config.enableSharing && config.url) {
        shareButton.classList.add("show");
        shareUrl.value = config.url;
      }

      // Transition style
      if (config.transitionStyle === "zoom") {
        mediaContainer.classList.add("transition-zoom");
      }

      // Create slides
      config.slides.forEach((slide, index) => {
        const isVideo = slide.file.match(/\.(mp4|webm|mov)$/i);

        if (isVideo) {
          const video = document.createElement("video");
          video.className = "slide-video";
          video.id = `slide-${index}`;
          video.src = slide.file;
          video.setAttribute("playsinline", "");
          video.setAttribute("webkit-playsinline", "");
          video.muted = true;
          if (slide.loop) video.loop = true;
          if (slide.autoAdvance !== false) {
            video.addEventListener("ended", () => setTimeout(nextSlide, 500));
          }
          video.addEventListener("click", nextSlide);
          mediaContainer.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.className = "slide-image";
          img.id = `slide-${index}`;
          img.src = slide.file;
          img.alt = slide.title || `Slide ${index + 1}`;

          // Ken Burns effect
          if (config.enableKenBurns) {
            img.classList.add("ken-burns");
          }

          img.addEventListener("click", nextSlide);
          mediaContainer.appendChild(img);
        }
      });

      // Preload
      config.slides.forEach(slide => {
        if (!slide.file.match(/\.(mp4|webm|mov)$/i)) {
          const img = new Image();
          img.src = slide.file;
        }
      });

      setupTouchHandlers();
    }

    // Touch handlers
    function setupTouchHandlers() {
      document.body.addEventListener("touchstart", (e) => {
        if (welcomeScreen.classList.contains("hidden") &&
            !infoPanel.classList.contains("open") &&
            !sharePanel.classList.contains("open")) {
          touchStartX = e.changedTouches[0].screenX;
          touchStartY = e.changedTouches[0].screenY;
        }
      }, { passive: true });

      document.body.addEventListener("touchend", (e) => {
        if (welcomeScreen.classList.contains("hidden") &&
            !infoPanel.classList.contains("open") &&
            !sharePanel.classList.contains("open")) {
          touchEndX = e.changedTouches[0].screenX;
          touchEndY = e.changedTouches[0].screenY;
          handleSwipe();
        }
      }, { passive: true });
    }

    function handleSwipe() {
      const deltaX = touchEndX - touchStartX;
      const deltaY = Math.abs(touchEndY - touchStartY);

      if (Math.abs(deltaX) > swipeThreshold && Math.abs(deltaX) > deltaY) {
        if (deltaX > 0) {
          showSwipeIndicator("üëâ");
          prevSlide();
        } else {
          showSwipeIndicator("üëà");
          nextSlide();
        }
      }
    }

    function showSwipeIndicator(emoji) {
      swipeIndicator.textContent = emoji;
      swipeIndicator.classList.add("show");
      setTimeout(() => swipeIndicator.classList.remove("show"), 300);
    }

    // Update slide with animations
    function updateSlide() {
      // Stop any existing auto-advance
      stopAutoAdvance();

      // Hide all slides
      document.querySelectorAll(".slide-image, .slide-video").forEach(el => {
        el.classList.remove("active");
        if (el.tagName === "VIDEO") {
          el.pause();
          el.currentTime = 0;
        }
      });

      // Hide text
      slideTitle.classList.remove("show");
      slideSubtitle.classList.remove("show");

      // Show current slide with delay for transition
      setTimeout(() => {
        const currentElement = document.getElementById(`slide-${currentSlide}`);
        if (currentElement) {
          currentElement.classList.add("active");
          if (currentElement.tagName === "VIDEO") {
            currentElement.play().catch(() => {});
          }
        }

        // Update text
        const slide = config.slides[currentSlide];
        slideTitle.textContent = slide.title || "";
        slideSubtitle.textContent = slide.subtitle || "";

        // Animate text in
        setTimeout(() => {
          if (slide.title) slideTitle.classList.add("show");
          if (slide.subtitle) slideSubtitle.classList.add("show");
        }, 100);

        // Info button
        if (slide.info && slide.info.length > 0) {
          infoButton.classList.add("show");
        } else {
          infoButton.classList.remove("show");
        }

        // Start auto-advance if configured
        if (slide.duration && slide.duration > 0) {
          startAutoAdvance(slide.duration);
        }
      }, 100);

      // Update controls
      slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide === totalSlides - 1;

      progressBar.style.width = ((currentSlide + 1) / totalSlides * 100) + "%";

      // Close panels
      infoPanel.classList.remove("open");
      sharePanel.classList.remove("open");
    }

    // Auto-advance functions
    function startAutoAdvance(duration) {
      if (isPaused) return;

      hasAutoAdvance = true;
      playPauseBtn.classList.add("show");
      playPauseBtn.textContent = "‚è∏";
      playPauseBtn.classList.remove("paused");

      remainingTime = duration;
      timerValue.textContent = remainingTime;
      countdownTimerEl.classList.add("show");
      countdownTimerEl.classList.remove("paused");

      // Countdown display
      countdownTimer = setInterval(() => {
        remainingTime--;
        timerValue.textContent = remainingTime;

        if (remainingTime <= 0) {
          clearInterval(countdownTimer);
        }
      }, 1000);

      // Auto-advance
      autoAdvanceTimer = setTimeout(() => {
        if (!isPaused && currentSlide < totalSlides - 1) {
          nextSlide();
        }
      }, duration * 1000);
    }

    function stopAutoAdvance() {
      if (autoAdvanceTimer) {
        clearTimeout(autoAdvanceTimer);
        autoAdvanceTimer = null;
      }
      if (countdownTimer) {
        clearInterval(countdownTimer);
        countdownTimer = null;
      }
      countdownTimerEl.classList.remove("show");

      // Hide play/pause if no more auto-advance slides
      const hasMoreAutoAdvance = config.slides.slice(currentSlide + 1).some(s => s.duration && s.duration > 0);
      if (!hasMoreAutoAdvance && !hasAutoAdvance) {
        playPauseBtn.classList.remove("show");
      }
    }

    function togglePlayPause() {
      isPaused = !isPaused;

      if (isPaused) {
        // Pause
        if (autoAdvanceTimer) clearTimeout(autoAdvanceTimer);
        if (countdownTimer) clearInterval(countdownTimer);
        playPauseBtn.textContent = "‚ñ∂";
        playPauseBtn.classList.add("paused");
        countdownTimerEl.classList.add("paused");
      } else {
        // Resume
        const slide = config.slides[currentSlide];
        if (slide.duration && remainingTime > 0) {
          playPauseBtn.textContent = "‚è∏";
          playPauseBtn.classList.remove("paused");
          countdownTimerEl.classList.remove("paused");

          // Resume countdown
          countdownTimer = setInterval(() => {
            remainingTime--;
            timerValue.textContent = remainingTime;

            if (remainingTime <= 0) {
              clearInterval(countdownTimer);
            }
          }, 1000);

          // Resume auto-advance
          autoAdvanceTimer = setTimeout(() => {
            if (!isPaused && currentSlide < totalSlides - 1) {
              nextSlide();
            }
          }, remainingTime * 1000);
        }
      }
    }

    // Navigation
    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateSlide();
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateSlide();
      }
    }

    function resetPresentation() {
      currentSlide = 0;
      updateSlide();
      welcomeScreen.classList.remove("hidden");
    }

    // Info panel
    function toggleInfo() {
      const slide = config.slides[currentSlide];
      if (slide.info) {
        infoContent.textContent = slide.info;
        infoPanel.classList.toggle("open");
        if (infoPanel.classList.contains("open")) {
          sharePanel.classList.remove("open");
        }
      }
    }

    // Share panel
    function toggleShare() {
      sharePanel.classList.toggle("open");
      if (sharePanel.classList.contains("open")) {
        infoPanel.classList.remove("open");
        generateQR();
      }
    }

    function copyToClipboard() {
      shareUrl.select();
      shareUrl.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(shareUrl.value).then(() => {
        showToast("L√§nk kopierad!");
      }).catch(err => {
        document.execCommand("copy");
        showToast("L√§nk kopierad!");
      });
    }

    function generateQR() {
      if (!config.url) return;
      qrCodeDiv.innerHTML = "";
      new QRCode(qrCodeDiv, {
        text: config.url,
        width: 200,
        height: 200,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2000);
    }

    // Event listeners
    startButton.addEventListener("click", () => {
      welcomeScreen.classList.add("hidden");
      setTimeout(updateSlide, 500);
    });

    prevBtn.addEventListener("click", prevSlide);
    nextBtn.addEventListener("click", nextSlide);
    playPauseBtn.addEventListener("click", togglePlayPause);
    resetBtn.addEventListener("click", resetPresentation);
    infoButton.addEventListener("click", toggleInfo);
    shareButton.addEventListener("click", toggleShare);
    infoClose.addEventListener("click", () => infoPanel.classList.remove("open"));
    shareClose.addEventListener("click", () => sharePanel.classList.remove("open"));
    copyButton.addEventListener("click", copyToClipboard);

    // Keyboard
    document.addEventListener("keydown", (e) => {
      if (!welcomeScreen.classList.contains("hidden")) {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          startButton.click();
        }
      } else {
        if (e.key === "ArrowRight") {
          e.preventDefault();
          nextSlide();
        } else if (e.key === " ") {
          e.preventDefault();
          // If auto-advance is active, toggle play/pause
          if (hasAutoAdvance && remainingTime > 0) {
            togglePlayPause();
          } else {
            nextSlide();
          }
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevSlide();
        } else if (e.key === "p" || e.key === "P") {
          e.preventDefault();
          if (hasAutoAdvance) togglePlayPause();
        } else if (e.key === "i" || e.key === "I") {
          e.preventDefault();
          toggleInfo();
        } else if (e.key === "s" || e.key === "S") {
          e.preventDefault();
          if (config.enableSharing && config.url) toggleShare();
        } else if (e.key === "Home") {
          e.preventDefault();
          resetPresentation();
        } else if (e.key === "End") {
          e.preventDefault();
          currentSlide = totalSlides - 1;
          updateSlide();
        } else if (e.key === "Escape") {
          e.preventDefault();
          infoPanel.classList.remove("open");
          sharePanel.classList.remove("open");
        }
      }
    });

    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener("touchend", (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    init();
  </script>
  </body>
</html>
