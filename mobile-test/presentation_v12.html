<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>StoryRooms Presentation</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
    }

    body {
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
    }

    /* Welcome Screen */
    #welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0076bc, #005a94);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: opacity 0.8s ease;
      padding: 20px;
    }

    #welcome-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #welcome-title {
      font-size: clamp(28px, 8vw, 52px);
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      text-align: center;
      line-height: 1.2;
    }

    #welcome-subtitle {
      font-size: clamp(16px, 4vw, 24px);
      opacity: 0.9;
      margin-bottom: 30px;
      text-align: center;
    }

    #welcome-meta {
      font-size: clamp(14px, 3.5vw, 18px);
      opacity: 0.8;
      margin-bottom: 30px;
      text-align: center;
    }

    #start-button {
      font-size: clamp(18px, 4vw, 22px);
      padding: 18px 40px;
      background: white;
      color: #0076bc;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      font-weight: 600;
      min-height: 56px;
      touch-action: manipulation;
    }

    #start-button:active {
      transform: scale(0.95);
    }

    /* Main Layout - NYTT: Text under bild */
    #main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding-top: 35px;
      padding-bottom: 90px;
    }

    /* Media Container - tar upp √∂vre delen */
    #media-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      min-height: 0;
      padding: 10px;
    }

    .slide-image, .slide-video {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      cursor: pointer;
      position: absolute;
      opacity: 0;
      transition: opacity 0.8s ease;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
      object-fit: contain;
      touch-action: manipulation;
    }

    .slide-image.active, .slide-video.active {
      opacity: 1;
      z-index: 10;
    }

    /* Text Area - ALLTID UNDER bilden */
    #text-area {
      flex-shrink: 0;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95), #000);
      padding: 20px 20px;
      min-height: 120px;
      max-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      border-top: 2px solid rgba(0, 118, 188, 0.3);
      gap: 8px;
    }

    #text-area:empty::after {
      content: "";
      display: block;
    }

    #slide-title {
      font-size: clamp(20px, 4.5vw, 32px);
      font-weight: 700;
      margin-bottom: 8px;
      color: #fff;
      text-align: center;
      line-height: 1.3;
      width: 100%;
      display: block;
    }

    #slide-subtitle {
      font-size: clamp(15px, 3.5vw, 20px);
      opacity: 0.9;
      color: #ddd;
      text-align: center;
      line-height: 1.4;
      width: 100%;
      display: block;
    }

    /* Info Button - i text-area */
    #info-button {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(0, 118, 188, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 20px;
      font-weight: 700;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      touch-action: manipulation;
      z-index: 200;
    }

    #info-button.show {
      display: flex;
    }

    #info-button:active {
      transform: scale(0.9);
      background: rgba(0, 118, 188, 1);
    }

    /* Info Panel - expanderbar */
    #info-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.98), rgba(0, 0, 0, 0.95));
      backdrop-filter: blur(20px);
      padding: 25px 20px 90px 20px;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 500;
      max-height: 60vh;
      overflow-y: auto;
      border-top: 2px solid rgba(0, 118, 188, 0.5);
      box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
    }

    #info-panel.open {
      transform: translateY(0);
    }

    #info-content {
      font-size: clamp(14px, 3.5vw, 16px);
      line-height: 1.6;
      color: #eee;
      white-space: pre-wrap;
    }

    #info-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      touch-action: manipulation;
    }

    #info-close:active {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Progress Bar */
    #progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, #0076bc, #00a8e8);
      transition: width 0.5s ease;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 118, 188, 0.6);
    }

    /* Controls - l√§ngst ner */
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 10px 18px;
      border-radius: 50px;
      display: flex;
      gap: 12px;
      align-items: center;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 40px rgba(0, 118, 188, 0.4);
      border: 1px solid rgba(0, 118, 188, 0.4);
      z-index: 1000;
    }

    button {
      background: linear-gradient(135deg, #0076bc, #005a94);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: clamp(14px, 3vw, 16px);
      font-weight: 600;
      transition: all 0.3s ease;
      min-height: 44px;
      touch-action: manipulation;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    button:disabled {
      background: #333;
      opacity: 0.4;
    }

    #slide-counter {
      color: white;
      font-size: clamp(13px, 3vw, 18px);
      font-weight: 600;
      min-width: 70px;
      text-align: center;
      background: rgba(0, 118, 188, 0.25);
      padding: 8px 12px;
      border-radius: 20px;
    }

    /* Branding */
    #branding {
      position: fixed;
      top: 10px;
      left: 15px;
      font-size: clamp(16px, 3.5vw, 20px);
      font-weight: 700;
      color: #0076bc;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0.8;
    }

    /* Keyboard Hints */
    #keyboard-hints {
      position: fixed;
      bottom: 15px;
      left: 15px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 12px;
      color: #ccc;
      backdrop-filter: blur(10px);
      z-index: 999;
      display: none;
    }

    #keyboard-hints kbd {
      background: rgba(255, 255, 255, 0.15);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 11px;
    }

    /* Swipe Indicator */
    #swipe-indicator {
      position: fixed;
      bottom: 50%;
      left: 50%;
      transform: translate(-50%, 50%);
      font-size: 18px;
      color: rgba(255, 255, 255, 0.7);
      background: rgba(0, 0, 0, 0.6);
      padding: 12px 20px;
      border-radius: 25px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 500;
      pointer-events: none;
    }

    #swipe-indicator.show {
      opacity: 1;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      #text-area {
        padding: 18px 15px;
        min-height: 100px;
        max-height: 160px;
      }

      #slide-title {
        font-size: 20px;
        margin-bottom: 6px;
      }

      #slide-subtitle {
        font-size: 15px;
      }

      #info-button {
        width: 32px;
        height: 32px;
        font-size: 18px;
        top: 12px;
        right: 12px;
      }

      #controls {
        gap: 10px;
        padding: 8px 15px;
      }
    }

    /* Desktop */
    @media (min-width: 769px) {
      #keyboard-hints {
        display: block;
      }

      button:hover:not(:disabled) {
        background: linear-gradient(135deg, #005a94, #004070);
        transform: translateY(-2px);
      }

      #start-button:hover {
        transform: scale(1.05);
      }

      #info-button:hover {
        background: rgba(0, 118, 188, 1);
        transform: scale(1.05);
      }
    }

    /* Landscape mobile */
    @media (max-height: 500px) and (orientation: landscape) {
      #text-area {
        padding: 12px 15px;
        min-height: 80px;
        max-height: 120px;
      }

      #slide-title {
        font-size: 18px;
        margin-bottom: 4px;
      }

      #slide-subtitle {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <!-- Welcome Screen -->
  <div id="welcome-screen">
    <div id="welcome-title"></div>
    <div id="welcome-subtitle"></div>
    <div id="welcome-meta"></div>
    <button id="start-button">Starta presentation</button>
  </div>

  <!-- Progress Bar -->
  <div id="progress-bar"></div>

  <!-- Branding -->
  <div id="branding">StoryRooms</div>

  <!-- Swipe Indicator -->
  <div id="swipe-indicator">üëà</div>

  <!-- Main Content -->
  <div id="main-content">
    <!-- Media (bild/video) h√§r -->
    <div id="media-container"></div>

    <!-- Text alltid UNDER -->
    <div id="text-area">
      <div id="slide-title"></div>
      <div id="slide-subtitle"></div>
      <button id="info-button">‚ÑπÔ∏è</button>
    </div>
  </div>

  <!-- Info Panel (expanderbar) -->
  <div id="info-panel">
    <button id="info-close">‚úï</button>
    <div id="info-content"></div>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button id="prev-btn">‚Üê</button>
    <div id="slide-counter"></div>
    <button id="next-btn">‚Üí</button>
    <button id="reset-btn">‚ü≤</button>
  </div>

  <!-- Keyboard Hints -->
  <div id="keyboard-hints">
    <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>i</kbd>
  </div>

  <script>
        const config = {
      title: "G√∂teborgs Befolkning",
      subtitle: "En visuell resa",
      author: "Henrik S√∂derholm",
      duration: 5,

      slides: [
{
      file: "RUM_0.png",
      title: "V√§lkommen",
      subtitle: "Swipe f√∂r att forts√§tta",
      info: "Detta √§r en presentation om G√∂teborgs befolkning. Klicka p√• ‚ÑπÔ∏è f√∂r mer information om varje slide."
    },
{
      file: "RUM_1.png",
      title: "Befolkningsutveckling",
      subtitle: "1990-2024",
      info: "G√∂teborgs folkm√§ngd har √∂kat med 25% sedan 1990. St√∂rst tillv√§xt har skett i f√∂rorterna.nnDatak√§lla: SCBnMetod: Registerbaserad befolkningsstatistik"
    },
{
      file: "RUM_2.png",
      title: "√Öldersstruktur",
      subtitle: "En √•ldrande befolkning",
      info: "Andelen √∂ver 65 √•r har √∂kat fr√•n 15% till 19% sedan √•r 2000.nnViktigt att notera: Samtidigt har barnantalet ocks√• √∂kat."
    },
{
      file: "sphere_popup.mp4",
      title: "Visualisering",
      subtitle: "Se hur sf√§ren v√§xer"
    },
{
      file: "RUM_9.png",
      title: "Tack!",
      subtitle: "Fr√•gor?",
      info: "Kontakt:nhenrik@goteborg.sennBaserat p√• data fr√•n SCB och G√∂teborgs Stad.nnSkapad med StoryRooms"
    }
      ]
    };

    let currentSlide = 0;
    let totalSlides = config.slides.length;
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartY = 0;
    let touchEndY = 0;
    const swipeThreshold = 50;

    // Elements
    const welcomeScreen = document.getElementById("welcome-screen");
    const welcomeTitle = document.getElementById("welcome-title");
    const welcomeSubtitle = document.getElementById("welcome-subtitle");
    const welcomeMeta = document.getElementById("welcome-meta");
    const startButton = document.getElementById("start-button");
    const mainContent = document.getElementById("main-content");
    const mediaContainer = document.getElementById("media-container");
    const textArea = document.getElementById("text-area");
    const slideTitle = document.getElementById("slide-title");
    const slideSubtitle = document.getElementById("slide-subtitle");
    const infoButton = document.getElementById("info-button");
    const infoPanel = document.getElementById("info-panel");
    const infoContent = document.getElementById("info-content");
    const infoClose = document.getElementById("info-close");
    const progressBar = document.getElementById("progress-bar");
    const slideCounter = document.getElementById("slide-counter");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const resetBtn = document.getElementById("reset-btn");
    const swipeIndicator = document.getElementById("swipe-indicator");

    // Initialize
    function init() {
      welcomeTitle.textContent = config.title;
      welcomeSubtitle.textContent = config.subtitle;
      welcomeMeta.textContent = `${totalSlides} slides ‚Ä¢ ~${config.duration} min`;
      if (config.author) welcomeMeta.textContent += ` ‚Ä¢ ${config.author}`;

      config.slides.forEach((slide, index) => {
        const isVideo = slide.file.match(/\.(mp4|webm|mov)$/i);
        if (isVideo) {
          const video = document.createElement("video");
          video.className = "slide-video";
          video.id = `slide-${index}`;
          video.src = slide.file;
          video.setAttribute("playsinline", "");
          video.setAttribute("webkit-playsinline", "");
          video.muted = true;
          if (slide.loop) video.loop = true;
          if (slide.autoAdvance !== false) {
            video.addEventListener("ended", () => setTimeout(nextSlide, 500));
          }
          video.addEventListener("click", nextSlide);
          mediaContainer.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.className = "slide-image";
          img.id = `slide-${index}`;
          img.src = slide.file;
          img.alt = slide.title || `Slide ${index + 1}`;
          img.addEventListener("click", nextSlide);
          mediaContainer.appendChild(img);
        }
      });

      // Preload
      config.slides.forEach(slide => {
        if (!slide.file.match(/\.(mp4|webm|mov)$/i)) {
          const img = new Image();
          img.src = slide.file;
        }
      });

      setupTouchHandlers();
    }

    // Touch handlers
    function setupTouchHandlers() {
      document.body.addEventListener("touchstart", (e) => {
        if (!welcomeScreen.classList.contains("hidden") && !infoPanel.classList.contains("open")) {
          touchStartX = e.changedTouches[0].screenX;
          touchStartY = e.changedTouches[0].screenY;
        }
      }, { passive: true });

      document.body.addEventListener("touchend", (e) => {
        if (!welcomeScreen.classList.contains("hidden") && !infoPanel.classList.contains("open")) {
          touchEndX = e.changedTouches[0].screenX;
          touchEndY = e.changedTouches[0].screenY;
          handleSwipe();
        }
      }, { passive: true });
    }

    function handleSwipe() {
      const deltaX = touchEndX - touchStartX;
      const deltaY = Math.abs(touchEndY - touchStartY);

      if (Math.abs(deltaX) > swipeThreshold && Math.abs(deltaX) > deltaY) {
        if (deltaX > 0) {
          showSwipeIndicator("üëâ");
          prevSlide();
        } else {
          showSwipeIndicator("üëà");
          nextSlide();
        }
      }
    }

    function showSwipeIndicator(emoji) {
      swipeIndicator.textContent = emoji;
      swipeIndicator.classList.add("show");
      setTimeout(() => swipeIndicator.classList.remove("show"), 300);
    }

    // Update slide
    function updateSlide() {
      document.querySelectorAll(".slide-image, .slide-video").forEach(el => {
        el.classList.remove("active");
        if (el.tagName === "VIDEO") {
          el.pause();
          el.currentTime = 0;
        }
      });

      const currentElement = document.getElementById(`slide-${currentSlide}`);
      if (currentElement) {
        currentElement.classList.add("active");
        if (currentElement.tagName === "VIDEO") {
          currentElement.play().catch(() => {});
        }
      }

      const slide = config.slides[currentSlide];
      slideTitle.textContent = slide.title || "";
      slideSubtitle.textContent = slide.subtitle || "";

      // Info button
      if (slide.info && slide.info.length > 0) {
        infoButton.classList.add("show");
      } else {
        infoButton.classList.remove("show");
      }

      slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide === totalSlides - 1;

      progressBar.style.width = ((currentSlide + 1) / totalSlides * 100) + "%";

      // Close info panel if open
      infoPanel.classList.remove("open");
    }

    // Navigation
    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateSlide();
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateSlide();
      }
    }

    function resetPresentation() {
      currentSlide = 0;
      updateSlide();
      welcomeScreen.classList.remove("hidden");
    }

    // Info panel
    function toggleInfo() {
      const slide = config.slides[currentSlide];
      if (slide.info) {
        infoContent.textContent = slide.info;
        infoPanel.classList.toggle("open");
      }
    }

    // Event listeners
    startButton.addEventListener("click", () => {
      welcomeScreen.classList.add("hidden");
      setTimeout(updateSlide, 500);
    });

    prevBtn.addEventListener("click", prevSlide);
    nextBtn.addEventListener("click", nextSlide);
    resetBtn.addEventListener("click", resetPresentation);
    infoButton.addEventListener("click", toggleInfo);
    infoClose.addEventListener("click", () => infoPanel.classList.remove("open"));

    // Keyboard
    document.addEventListener("keydown", (e) => {
      if (!welcomeScreen.classList.contains("hidden")) {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          startButton.click();
        }
      } else {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextSlide();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevSlide();
        } else if (e.key === "i" || e.key === "I") {
          e.preventDefault();
          toggleInfo();
        } else if (e.key === "Home") {
          e.preventDefault();
          resetPresentation();
        } else if (e.key === "End") {
          e.preventDefault();
          currentSlide = totalSlides - 1;
          updateSlide();
        } else if (e.key === "Escape") {
          e.preventDefault();
          infoPanel.classList.remove("open");
        }
      }
    });

    // Prevent double-tap zoom
    let lastTouchEnd = 0;
    document.addEventListener("touchend", (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    init();
  </script>
</body>
</html>
